# 이미지 일괄 다운로드 (Chrome MV3)

페이지에 있는 이미지를 자동으로 수집하고, 원하는 것만 선택해 순서대로 번호를 붙여 다운로드합니다.

## 주요 기능

- 자동 수집: 팝업을 열면 즉시 페이지의 이미지 미리보기를 로드합니다.
- 선택 다운로드: 썸네일을 클릭해 선택/해제. “전체 선택/해제” 제공.
- 선택 반전/재시도: “선택 반전”으로 빠르게 토글, 자동 수집 실패 시 “다시 시도” 버튼으로 재시도.
- 순차 저장: `접두사-1.ext`, `접두사-2.ext` … 순서대로 한 개씩 저장.
- 접두사 자동 채움: 하이픈 없는 `uuidv4`를 기본 접두사로 입력.
- CSS 배경 포함: `<img>`와 CSS `background-image` 이미지 모두 수집.
- 하위 폴더 저장: 다운로드 폴더 바로 저장 또는 지정한 하위 폴더에 저장.
- 폴더 프리셋: 자주 쓰는 폴더명을 저장/선택/삭제.

## 설치 (개발자 모드)

1. Chrome → `chrome://extensions/`
2. 우측 상단 “개발자 모드” 켜기
3. “압축해제된 확장 프로그램을 로드” → 이 폴더 선택
4. 툴바에서 확장 아이콘 고정 후 사용

## 사용법

1) 팝업을 열면 이미지가 자동으로 로드됩니다. 기본 선택 상태는 전체 해제입니다.

2) 접두사 확인/수정 후, 썸네일을 클릭하여 필요한 이미지만 선택하세요.

3) 저장 위치 선택
- 직접 저장: 다운로드 폴더 바로 저장
- 하위 폴더 저장: 폴더명을 입력하면 `다운로드/폴더명/접두사-N.ext`
  - 폴더 프리셋 드롭다운에서 자주 쓰는 폴더를 선택/추가/삭제할 수 있습니다.

4) “선택한 이미지 다운로드”를 누르면 선택된 이미지만 순서대로 저장합니다.

## 동작 상세

- 파일명: `접두사-번호.확장자` (확장자는 URL/데이터URL의 MIME에서 추정, 불명확 시 `.jpg`)
- 중복 제거: 같은 URL은 1회만 수집
- 순차 저장: 각 다운로드가 완료/중단될 때까지 기다린 뒤 다음 항목 진행
- 충돌 처리: 동일 파일명이 존재하면 고유하게(`uniquify`) 저장

## 저장 위치 옵션

- 기본: 다운로드 폴더에 바로 저장
- 옵션: 하위 폴더에 저장 (폴더명은 비어있음이 기본값)
- 폴더명/접두사 안전화: `\\/:*?"<>|` 등 위험 문자를 `-`로 치환, 상대경로(`..`) 금지, 길이 제한 적용

### 폴더 프리셋

- 선택: 드롭다운에서 프리셋 선택 시 입력칸에 반영되고 “하위 폴더에 저장”이 활성화됩니다.
- 추가: 현재 폴더명을 프리셋으로 저장
- 삭제: 선택된 프리셋 제거
- 저장 위치: `chrome.storage.local` (실제 디스크 폴더는 다운로드 시 자동 생성)

## 제한 사항

- 수집 범위: `<img>`와 CSS `background-image`
- 제외: `blob:` URL은 브라우저 컨텍스트 제약으로 기본 제외
- 지원: `data:` 및 `http/https` URL

## 접근성/사용성

- 썸네일 카드는 키보드 포커스 가능(`tab`)하며 Enter/Space로 선택 토글됩니다.
- 상태/카운트 영역은 보조 기술을 위해 `aria-live="polite"`가 적용되어 있습니다.

## 권한 안내

- `downloads`: 파일 저장을 위해 필요
- `activeTab`: 현재 탭의 DOM 접근 메시징을 위해 필요
- `content_scripts/host_permissions: <all_urls>`: 이미지 URL 수집을 위해 필요 (특수 페이지는 제한될 수 있음)

## 개발 팁

- 코드 수정 후 `chrome://extensions`에서 “새로고침” 또는 확장 팝업을 다시 열어 반영 확인
- 특수 페이지(예: Chrome 웹 스토어, `chrome://*`)에서는 동작이 제한될 수 있음

## 문제 해결

- 이미지가 비어있음: SPA/지연 로드 페이지는 잠시 대기 후 팝업을 다시 열어보세요.
- 일부 이미지 누락: `blob:` URL은 다운로드에서 제외됩니다.
- 파일명이 모두 `.jpg`: 확장자 추정이 불가한 경우 기본값으로 저장됩니다.
